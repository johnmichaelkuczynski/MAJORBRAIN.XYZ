SEVERAL ISSUES WITH DEBATE FUNCTION. FIRST, IT IS NOT STREAMING OUT. SECOND, IT DOES NOT COME OUT AT ALL: NO OUTPUT. THIRD, ON THE RARE OCCASIONS THAT THERE IS OUTPUT, IT IS REPETITIVE AND IT FAILS TO PULL FROM THE UPLOADED MATERIAL. TO THIS END IMPLEMENT THE FOLLOWING: ANTI-REPETITION AND DATASET EXHAUSTION RULES
1. NO REPETITION OF ARGUMENTATIVE CONTENT.
Before generating any new turn in the dialogue, the app must check whether the point about to be made has already been made in a prior turn — by either debater. "Same point" means: same logical claim, same objection structure, or same counterexample pattern, regardless of whether different proper names, analogies, or illustrative examples are swapped in. Swapping Rumi for Eckhart while making the identical argument about cross-traditional convergence counts as repetition. Swapping the copper example for a gold example while making the identical argument about mind-independent truth-values counts as repetition.
The ONLY permissible re-invocation of a previously stated idea is when that idea serves as a premise in a NEW argument that was not previously made. In that case, the idea should be referenced briefly (not re-argued) and immediately deployed toward the new conclusion. If the new conclusion cannot be clearly stated, the re-invocation is not justified.
Implement this as a hard constraint: maintain a running log (structured list) of every distinct philosophical claim, objection, and argumentative move made so far in the dialogue. Before generating each new turn, compare the candidate content against this log. If it matches an existing entry and does not serve as a premise for a genuinely novel argument, reject it and generate a different turn.
2. EXHAUST ALL UPLOADED MATERIAL BEFORE ANY RECYCLING.
Each debater has access to (a) documents uploaded specifically to that debater and (b) common documents shared across both debaters. The app must track which specific positions, arguments, examples, and claims from these uploaded documents have already been used in the dialogue and which have NOT.
Before generating any new turn, the app must query the unused portion of that debater's uploaded material FIRST. The app should select the strongest unused argument or position from the uploaded documents that is responsive to the opponent's most recent point. Only if NO unused material from the uploads is responsive to the current state of the debate may the app generate content not directly sourced from uploads — and even then, it must not repeat previously used material.
Implement this as: maintain a usage-tracking index against all extracted positions/arguments from uploaded documents. Each position gets flagged as USED or UNUSED. The generation pipeline must prioritize UNUSED positions. If the ratio of USED to total positions exceeds 90%, the app should signal that the debate's source material is approaching exhaustion and prompt the user for direction (continue with model-generated content, stop, or upload additional material).
3. TERMINATION LOGIC.
The dialogue should end when: (a) all uploaded material from both debaters has been substantively deployed, AND (b) no new argumentative moves remain that are not repetitions of prior moves. The app must NEVER pad length by cycling through variations of exhausted arguments. A shorter, non-repetitive dialogue is always preferable to a longer, repetitive one.

That targets both problems directly. The running log of claims prevents repetition mechanically rather than relying on the model's judgment, and the usage-tracking index forces the app to pull from uploads before freelancing.